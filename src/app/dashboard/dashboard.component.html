<div class="row">
	<div class="col-12">
		<p class="nimble-title" i18n>Dashboard</p>
		<div *ngIf="appComponent.checkRoles('reg_comp')&&!alert1Closed">
			<p class="space-before">
				<ngb-alert type="info" (close)="alert1Closed=true">
					You are not yet linked to a company.<br/>
					You can register your company now.
				</ngb-alert>
			</p>
		</div>
		<p *ngIf="appComponent.checkRoles('wait_comp')&&!alert2Closed" class="space-before">
			<ngb-alert type="info" (close)="alert2Closed=true">
				Your company is now registered.<br/>
				You can start publishing your catalogue.<br/>
				In order to execute business processes your company needs to be verified by an administrator - please stay tuned.<br/>
				If you are not being verified with one business day, please contact our support nimble-support@salzburgresearch.at.
			</ngb-alert>
		</p>
		<div class="space-before nimble-col">
			<span i18n>Welcome to the</span> NIMBLE <span i18n>platform,</span> {{fullName}}!<br/>
			<i><small>Collaborative Network for Industry, Manufacturing, Business and Logistics in Europe.</small></i>
		</div>
	</div>
</div>

<ul class="nav nav-tabs space-before">
	<li *ngIf="appComponent.checkRoles('sales')" class="nav-item">
		<a class="nav-link" [ngClass]="{'active':tab=='sales'}" routerLink="/dashboard" (click)="tab='sales'">Sales <span class="badge badge-pill badge-warning">{{active_seller_num}}</span></a>
	</li>
	<li *ngIf="appComponent.checkRoles('purchases')" class="nav-item">
		<a class="nav-link" [ngClass]="{'active':tab=='purchases'}" routerLink="/dashboard" (click)="tab='purchases'">Purchases <span class="badge badge-pill badge-warning">{{active_buyer_num}}</span></a>
	</li>
</ul>

<div class="row space-before" *ngIf="appComponent.checkRoles('sales') && tab=='sales'">
	<div class="col-12">
		<!--<h4 class="space-after" i18n>Sales</h4>-->
		<div *ngIf="seller_history.length > 0">
			<table class="table table-striped table-bordered">
				<tr><th>Process</th><th i18n>Date</th><th i18n>Product</th><th i18n>Buyer</th><th i18n>Note</th><th colspan="2" i18n>Status</th><th i18n>Options</th></tr>
				<tr *ngFor="let processMetadata of seller_history">

					<td>{{processMetadata.processTypeReadable}}</td>
					<td>{{processMetadata.start_time }}</td>
					<td>
						<label class="clickable" (click)="navigateToSearchDetails(processMetadata.product)">
							{{processMetadata.product.name}}
						</label>
					</td>
					<td>{{processMetadata.buyerName }}</td>
					<td>{{processMetadata.note}}</td>
					<td *ngIf="processMetadata.statusCode=='deleted'" class="table-danger">{{processMetadata.actionStatus}}</td><td *ngIf="processMetadata.statusCode=='deleted'" class="table-danger">Canceled</td>
					<td *ngIf="processMetadata.statusCode=='completed'" class="table-success">{{processMetadata.actionStatus}}</td><td *ngIf="processMetadata.statusCode=='completed'" class="table-success">Completed</td>
					<td *ngIf="processMetadata.statusCode!='deleted' && processMetadata.statusCode!='completed' && (!processMetadata.actionRequired || !appComponent.checkRoles('bp'))" class="table-warning">{{processMetadata.actionStatus}}</td><td *ngIf="processMetadata.statusCode!='deleted' && processMetadata.statusCode!='completed' && processMetadata.actionRequired" class="table-warning"><span class="clickable" (click)="openBpProcessView('seller', processMetadata.bpOptionMenuItems[0].targetProcess ,processMetadata)">{{processMetadata.actionStatus}}</span></td><td *ngIf="processMetadata.statusCode!='deleted' && processMetadata.statusCode!='completed'" class="table-warning">In Progress</td>

					<td>
						<div *ngIf="appComponent.checkRoles('bp')&&processMetadata.statusCode!='deleted'" ngbDropdown placement="left">
							<i class="fa fa-bars fa-lg nav-link pointer" id="bpOptionsMenuSeller" ngbDropdownToggle aria-hidden="true"></i>
							<div ngbDropdownMenu aria-labelledby="bpOptionsMenuSeller">
								<div *ngFor="let menuItem of processMetadata.bpOptionMenuItems; let i = index"
									class="dropdown-item">
									<label *ngIf="i == 0"
										   (click)="openBpProcessView('seller', menuItem.targetProcess ,processMetadata)">
										{{menuItem.itemLabel}}
									</label>
									<label *ngIf="i == 1"
										   (click)="openBpProcessView('seller', menuItem.targetProcess ,processMetadata)">
										{{menuItem.itemLabel}}
									</label>
								</div>
								<div *ngIf="processMetadata.statusCode!='completed'" class="dropdown-item">
									<label (click)="cancelBP(processMetadata.process_id)">Cancel Process</label>
								</div>
							</div>
						</div>
					</td>
				</tr>
			</table>
		</div>
		<div *ngIf="seller_history.length == 0">
			<span i18n>No data</span>
		</div>
	</div>
</div>

<div class="row space-before" *ngIf="appComponent.checkRoles('purchases') && tab=='purchases'">
	<div class="col-12">
		<!--<h4 class="space-after" i18n>Purchases</h4>-->
		<div *ngIf="buyer_history.length > 0">
			<table class="table table-striped table-bordered">
				<tr><th>Process</th><th i18n>Date</th><th i18n>Product</th><th i18n>Seller</th><th i18n>Note</th><th colspan="2" i18n>Status</th><th i18n>Options</th></tr>
				<tr *ngFor="let processMetadata of buyer_history">
					<td>{{processMetadata.processTypeReadable}}</td>
					<td>{{processMetadata.start_time }}</td>
					<td>
						<label class="clickable" (click)="navigateToSearchDetails(processMetadata.product)">
							{{processMetadata.product.name}}
						</label>
					</td>
					<td>{{processMetadata.sellerName }}</td>
					<td>{{processMetadata.note}}</td>
					<td *ngIf="processMetadata.statusCode=='deleted'" class="table-danger">{{processMetadata.actionStatus}}</td><td *ngIf="processMetadata.statusCode=='deleted'" class="table-danger">Canceled</td>
					<td *ngIf="processMetadata.statusCode=='completed'" class="table-success">{{processMetadata.actionStatus}}</td><td *ngIf="processMetadata.statusCode=='completed'" class="table-success">Completed</td>
					<td *ngIf="processMetadata.statusCode!='deleted' && processMetadata.statusCode!='completed' && (!processMetadata.actionRequired || !appComponent.checkRoles('bp'))" class="table-warning">{{processMetadata.actionStatus}}</td><td *ngIf="processMetadata.statusCode!='deleted' && processMetadata.statusCode!='completed' && processMetadata.actionRequired" class="table-warning"><span class="clickable" (click)="openBpProcessView('buyer', processMetadata.bpOptionMenuItems[0].targetProcess ,processMetadata)">{{processMetadata.actionStatus}}</span></td><td *ngIf="processMetadata.statusCode!='deleted' && processMetadata.statusCode!='completed'" class="table-warning">In Progress</td>

					<td>
						<div *ngIf="appComponent.checkRoles('bp')&&processMetadata.statusCode!='deleted'" ngbDropdown placement="left">
							<i class="fa fa-bars fa-lg nav-link pointer" id="bpOptionsMenuBuyer" ngbDropdownToggle aria-hidden="true"></i>
							<div ngbDropdownMenu aria-labelledby="bpOptionsMenuBuyer">
								<div *ngFor="let menuItem of processMetadata.bpOptionMenuItems; let i = index"
									 class="dropdown-item">
									<label *ngIf="i == 0"
										   (click)="openBpProcessView('buyer',  menuItem.targetProcess, processMetadata)">
										{{menuItem.itemLabel}}
									</label>
									<label *ngIf="i == 1"
										   (click)="openBpProcessView('buyer', menuItem.targetProcess, processMetadata)">
										{{menuItem.itemLabel}}
									</label>
								</div>
								<div *ngIf="processMetadata.statusCode!='completed'" class="dropdown-item">
									<label (click)="cancelBP(processMetadata.process_id)">Cancel Process</label>
								</div>
							</div>
						</div>
					</td>
				</tr>
			</table>
		</div>
		<div *ngIf="buyer_history.length == 0">
			<span i18n>No data</span>
		</div>
	</div>
</div>
