<div *ngIf="!customCategoryPage && !treeView">
    <h3 i18n>Choose product (or service) category</h3>

    <div class="row justify-content-md-center col-12 mt-3">

        <!-- search by pressing enter! -->
        <form #categorySearch="ngForm" (ngSubmit)="onSearchCategory()"
              class="col-12 row justify-content-md-center" novalidate>

            <div [hidden]="callback || !submitted || error_detc" class="space-right">
                <img class="space-before" src="assets/form_loader.gif"/>
            </div>

            <input class="form-control col-4" name="inputCtrl" [(ngModel)]="categoryKeyword" required/>
            <button type="submit" class="btn btn-success col-3 ml-3" [disabled]="!categorySearch.form.valid" i18n>Search product category</button>
        </form>

    </div>

    <div class="d-flex justify-content-end space-before" *ngIf="callback && !submitted">
        <div class="align-self-center space-right">
            Could not find a proper category for your product?
        </div>
        <button class="btn btn-danger" (click)="customCategoryPage=true">Specify your own category</button>
    </div>

    <div *ngIf="callback && !submitted && (!categories || categories.length == 0)" class="align-center space-before bordered">
        <h4>No results found.</h4>
    </div>


    <ul class="list-group container mt-4" style="max-height: 500px; overflow-y: scroll;" *ngIf="callback && !submitted">
        <li *ngFor="let category of categories"
            class="list-group-item row pointer"
            style="padding: .25rem 1.25rem; display: flex;"
            (click)="getCategoryDetails(category)"
            [style.background-color]="selectedCategory && category.code == selectedCategory.code ? 'green' : 'white'"
        >
            <div class="col-2">{{category.taxonomyId}}</div>
            <div class="col">{{category.preferredName}}</div>
    <!--        <i class="fa fa-plus-circle pointer" (click)="selectCategory(category)"><i/> -->
            <span *ngIf="category.taxonomyId == 'eClass'" class="fa fa-share-alt" aria-hidden="true" (click)="getCategoryTree(category)"></span>
        </li>
    </ul>
</div>

<div *ngIf="!customCategoryPage && treeView">
    <h3 i18n>Choose product (or service) category</h3>

    <div class="row justify-content-md-center col-12 mt-3">

        <!-- search by pressing enter! -->
        <form #categorySearch="ngForm" (ngSubmit)="onSearchCategory()"
              class="col-12 row justify-content-md-center" novalidate>

            <div [hidden]="callback || !submitted || error_detc" class="space-right">
                <img class="space-before" src="assets/form_loader.gif"/>
            </div>

            <input class="form-control col-4" name="inputCtrl" [(ngModel)]="categoryKeyword" required/>
            <button type="submit" class="btn btn-success col-3 ml-3" [disabled]="!categorySearch.form.valid" i18n>Search product category</button>
        </form>

    </div>

    <div class="d-flex justify-content-end space-before" *ngIf="callback && !submitted">
        <div class="align-self-center space-right">
            Could not find a proper category for your product?
        </div>
        <button class="btn btn-danger" (click)="customCategoryPage=true">Specify your own category</button>
    </div>
    <div *ngIf="parentCategories">
        <p class="space-before">
            <ngb-alert type="info" (close)="treeView=false;selectedCategoryWithDetails=null;parentCategories=null">
                <span *ngFor="let parentCat of parentCategories.parents;let l=last">
                    {{parentCat.preferredName}}
                    <span *ngIf="!l">
                         >>
                    </span>
                </span>
            </ngb-alert>
        </p>
        <div class="d-flex bordered" style="height: 400px">
            <div *ngFor="let categories of parentCategories.categories" class="col-3" style="overflow: hidden" onmouseover="this.style.overflow='auto'" onmouseout="this.style.overflow='hidden'">
                <label *ngFor="let cat of categories" (click)="getCategoryTree(cat)"
                       [style.font-weight]="selectedCategoriesWRTLevels.indexOf(cat.code)>-1 ? 'bold' : 'normal'"
                       [style.color]="selectedCategoriesWRTLevels.indexOf(cat.code)>-1 ?'green' : 'black'"
                       [style.text-decoration]="selectedCategoriesWRTLevels.indexOf(cat.code)>-1 ? 'underline' : 'none'"
                       class="pointer" style="display: block;">{{cat.preferredName}}</label>
            </div>
        </div>
    </div>
</div>

<div *ngIf="!customCategoryPage && selectedCategoryWithDetails" class="bordered space-before">
    <div class="d-flex" *ngIf="selectedCategoryWithDetails.preferredName">
        <label class="col-3"><b>Name:</b></label><span>{{selectedCategoryWithDetails.preferredName}}</span>
        <button class="btn btn-success ml-auto" (click)="selectCategory(selectedCategoryWithDetails)">Select</button>
    </div>
    <div *ngIf="selectedCategoryWithDetails.taxonomyId">
        <label class="col-3"><b>TaxonomyId:</b></label>{{selectedCategoryWithDetails.taxonomyId}}
    </div>
    <div *ngIf="selectedCategoryWithDetails.code">
        <label class="col-3"><b>Code:</b></label>{{selectedCategoryWithDetails.code}}
    </div>
    <div *ngIf="selectedCategoryWithDetails.level">
        <label class="col-3"><b>Level:</b></label>{{selectedCategoryWithDetails.level}}
    </div>
    <div class="d-flex" *ngIf="selectedCategoryWithDetails.definition && selectedCategoryWithDetails.definition != 'no definition available'">
        <label class="col-3" style="float: left"><b>Definition:</b></label>
        <div>
            {{selectedCategoryWithDetails.definition}}
        </div>
    </div>
    <div class="d-flex" *ngIf="selectedCategoryWithDetails.note">
        <label class="col-3"><b>Note:</b></label>{{selectedCategoryWithDetails.note}}
    </div>
    <div class="d-flex" *ngIf="selectedCategoryWithDetails.remark">
        <label class="col-3" style="float: left"><b>Remark:</b></label>{{selectedCategoryWithDetails.remark}}
    </div>

    <div *ngFor="let prop of selectedCategoryWithDetails.properties;let i = index;let l = last">
        <label *ngIf="i == 0" class="col-3" style="float: left"><b>Properties:</b></label>
        <label *ngIf="i<3 || showOtherProperties" class="col-3" style="padding: 0px" [ngClass]="{'offset-3' : i > 0} ">
            {{prop.preferredName}}
            <span *ngIf="prop.definition" class="label label-default" title="{{prop.definition}}">
                    &#9432;
            </span>
        </label>

        <label *ngIf="i<3 || showOtherProperties" class="align-self-start offset-3">
            {{prop.dataType}}
        </label>

        <div class="d-flex justify-content-center" *ngIf="l == true && i > 3 && !showOtherProperties">
            <button class="space-after" style="background-color: transparent;border: none;outline: none" (click)="showOtherProperties = true" >
                &nbsp;&nbsp;<i class="fa fa-angle-double-down" aria-hidden="true"></i>
            </button>
        </div>
        <div class="d-flex justify-content-center" *ngIf="l == true && showOtherProperties">
            <button class="space-after" style="background-color: transparent;border: none;outline: none" (click)="showOtherProperties = false">
                &nbsp;&nbsp;<i class="fa fa-angle-double-up" aria-hidden="true"></i>
            </button>
        </div>
    </div>
</div>

<call-status [callStatus]="callStatus"
             [large]="true">
</call-status>

<!-- custom category view -->
<div *ngIf="customCategoryPage">
    <form #customCategoryForm="ngForm" class="row justify-content-md-center align-items-center col-12 mt-3">
        <i class="fa fa-reply space-right pointer" (click)="customCategoryPage = false;"></i>
        <input name="inputCtrl" [(ngModel)]="customCategory" class="form-control space-right col-4" required>
        <button class="btn btn-success" (click)="addCustomCategory(customCategory)" [disabled]="!customCategoryForm.form.valid">Continue Publishing</button>
    </form>
</div>

<div class="row col-12 justify-content-center">
    <button class="btn btn-outline-warning mt-3" (click)="selectCategory(null)" i18n>Continue publishing without a
        category
    </button>
</div>
